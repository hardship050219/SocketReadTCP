<?xml version="1.0" encoding="utf-8"?>

<nlog xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
		autoReload="true"
		throwExceptions="false"
		internalLogLevel="Info"
		internalLogFile="${basedir}/AppData/Log/#NLogInternal.txt">
	<targets>
		<target
			name="DB"
			xsi:type="Database"
			dbProvider="Microsoft.Data.Sqlite.SqliteConnection, Microsoft.Data.Sqlite"
			connectionString="Data Source=${basedir}/AppData/Logs.db;"
			keepConnection="true"
			commandType="Text"
			commandText="INSERT INTO LogRecord (Time, Level, Logger, Message, Exception, Data, Tag, Action, Result, MId) 
               VALUES (@时间, @等级, @记录器, @消息, @异常, @数据, @标识, @动作, @结果, @消息ID)">
			<parameter name="@时间" layout="${longdate}" />
			<parameter name="@等级" layout="${level}" />
			<parameter name="@记录器" layout="${logger}" />
			<parameter name="@消息" layout="${message}" />
			<parameter name="@异常" layout="${exception:format=ToString}" />
			<parameter name="@数据" layout="${event-properties:item=data}" />
			<parameter name="@标识" layout="${event-properties:item=tag}" />
			<parameter name="@动作" layout="${event-properties:item=action}" />
			<parameter name="@结果" layout="${event-properties:item=result}" />
			<parameter name="@消息ID" layout="${event-properties:item=mid}" />
		</target>

		<target name="asyncFile" xsi:type="AsyncWrapper">
			<target
				name="CommonToFile" xsi:type="File"
				fileName="${basedir}/AppData/Logs/${date:format=yyMMdd}.log.txt"
				layout="${date:format=yyMMdd HH\:mm\:ss\.fff} ${level:uppercase=true:padding=5} ${logger}: ${message}${onexception:${newline}${exception:format=tostring}}"
				archiveFileName="${basedir}/AppData/Logs/${date:format=yyMMdd}-{#####}.log.txt"
				archiveAboveSize="5242880"
				archiveNumbering="Sequence"
				concurrentWrites="true"
				keepFileOpen="true" />
		</target>
		<!--使用可自定义的着色将日志消息写入控制台-->
		<target name="ColorConsole" xsi:type="ColoredConsole"
					layout="${date:format=yyMMdd HH\:mm\:ss\.fff} ${level:format=FirstCharacter} [${logger}]: ${message}${onexception:${newline}${exception:format=tostring}}">
			<highlight-row condition="level == LogLevel.Fatal" foregroundColor="Red" backgroundColor="Black" />
			<highlight-row condition="level == LogLevel.Error" foregroundColor="DarkRed" />
			<highlight-row condition="level == LogLevel.Warn" foregroundColor="Yellow" />
			<!-- <highlight-row condition="level == LogLevel.Info" foregroundColor="Green" /> -->
			<highlight-row condition="level == LogLevel.Debug" foregroundColor="Gray" />
			<highlight-row condition="level == LogLevel.Trace" foregroundColor="DarkGray" />
		</target>
		<!-- <target name="AppLog" xsi:type="AppLog" -->
		<!--         layout="${date:format=yyMMdd HH\:mm\:ss\.fff} ${level:format=FirstCharacter} [${logger}]: ${message}${onexception:${newline}${exception:format=tostring}}"/> -->
	</targets>

	<!--规则配置,final - 最终规则匹配后不处理任何规则-->
	<rules>
		<logger name="ZIT-APP" minlevel="Trace" writeTo="ColorConsole,DB" final="true" />
		<logger name="*" minlevel="Debug" writeTo="DB" />
		<logger name="*" minlevel="Debug" writeTo="ColorConsole" />
	</rules>
</nlog>